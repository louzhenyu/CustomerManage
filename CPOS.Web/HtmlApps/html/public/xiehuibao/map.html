<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
body, html,#mapArea {width: 100%;height: 100%;overflow: hidden;margin:0;}
.conmenu{ 
position: absolute;
z-index: 100;
right: 12px;
bottom: 102;
height: 80px;
width: 35px;
display: none;

}
.conmenu a{display: block;width: 35px;height: 35px;margin-bottom: 8px; background-size: 35px auto;   }
.conmenu a:nth-child(1){
background-image: url("../../../images/common/mapgoto.png");
background-repeat: no-repeat;

}
.conmenu a:nth-child(2){
   background-image: url("../../../images/common/mapto360.png");
    background-position: center center;
    background-repeat: no-repeat;
background-size: 34px auto;
}

.popup {background:#333; padding:10px; width:90%; margin:0 auto;}
.popup p.ac { padding:10px 0; color: white;font-size: 14px; }
.popup_btn {display:-webkit-box;-webkit-box-flex:1;-webkit-box-pack:center;}
.popup_btn a { display:block; height:40px; line-height:40px; width:48%; text-align:center; background:#3C3C3C; border:1px solid #000; color:#fff; -webkit-border-radius:5px;-o-border-radius:5px;border-radius:5px; font-size:14px; margin:0 5px;-webkit-box-shadow:inset 0 1px 3px rgba(255,255,255, 0.3);}

.navItem{
    background: none repeat scroll 0 0 rgba(0, 0, 0, 0.7);
    border-radius: 2px;
    top: 20px;
    color: #FFFFFF;
    display: none;
    font-size: 1rem;
    height: 30px;
    line-height: 30px;
    position: fixed;
    text-align: center;
    width: 75px;
    z-index: 105;
}

.moreMap{
    left: 10px;
}
.toAddress{
    right: 10px;
    display: block;
    z-index: 99;
}

.locationArea{position:relative;  max-width:640px;margin:0 auto;z-index: 104;
    -webkit-transition: all 1s;
    -moz-transition: all 1s;
    transition: all 1s;
    transform: scale(0.2);
        -webkit-transform: scale(0.2);
             -moz-transform: scale(0.2);
    display: none;
}
.showex{
    transform: scale(1);
        -webkit-transform: scale(1);
             -moz-transform: scale(1);
}


.locationArea .locationBg{width:100%;height:100%;}
.locationArea .beijing{width:70px;height:105px;position:absolute;top:19%;left:38%;}
.locationArea .shanghai{width:105px;height:155px;position:absolute;top:31%;right:7%;}
.locationArea .shenzhen{width:53px;height:78px;position:absolute;bottom:10%;left:42%;}


</style>
    <script type="text/javascript" src="../../../lib/zepto.min.js" defer async data-main="../../../launch"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=TBxZGjIuy9pBfmGmoRaGsih1"></script>
    <title>地图查询</title>
</head>
<body >
    <div class="navItem moreMap">校园切换</div>
    <div class="navItem toAddress" id="goto">到这里去</div>
    <div class="locationArea" id="moreAddress">
        <img class="locationBg" src="../../../images/public/xiehuibao/locationBg.jpg"  />

        <img class="beijing" data-lng="117.1140243319" data-lat="40.1695817711" src="../../../images/public/xiehuibao/beijing.png" data-address="北京市海淀区东北旺西路8号中关村软件园20号楼" data-store="北京校区" />
        <img class="shanghai" data-lng="121.6025980706" data-lat="31.2428503838" src="../../../images/public/xiehuibao/shanghai.png" data-address="上海浦东红枫路699号" data-store="上海校区" />
        <img class="shenzhen" data-lng="113.9909290505" data-lat="22.5410256591" src="../../../images/public/xiehuibao/shenzhen.png" data-address="深圳市福田中心区益田路6003号荣超中心A座8层" data-store="深圳校区" />
    </div>
<!--     <div class="conmenu" id="conmenu">
        <a href="javascript:;" style="display:none" ></a>
        <a href="http://www.o2omarketing.cn:9004/vtour/tour.html" ></a>
    </div> -->

    <div id="mapArea"></div>

</body>
</html>
<script type="text/javascript">
var Base = {
    keyList:{lng:'lng',lat:'lat',address:'address',store:'store'},
    elements:{goto:'',conmenu:''},
            Dialog:function(cfg){
            
            if(cfg == 'CLOSE'){
                
                var panel = $('.jit-ui-panel');
                
                if(panel){
                
                    (panel.parent()).remove();
                }
                
            }else{
                
                cfg.LabelOk = cfg.LabelOk?cfg.LabelOk:'确定';
                
                cfg.LabelCancel = cfg.LabelOk?cfg.LabelCancel:'取消';
                
                var panel,btnstr;
                
                if(cfg.type == 'Alert' || cfg.type == 'Confirm'){
                
                    btnstr = (cfg.type == 'Alert')?'<a id="jit_btn_ok" style="margin:0 auto">'+cfg.LabelOk+'</a>':'<a id="jit_btn_cancel">'+cfg.LabelCancel+'</a><a id="jit_btn_ok">'+cfg.LabelOk+'</a>';
                
                    panel = $('<div"><div class="jit-ui-panel"></div><div name="jitdialog" style="margin-top:120px" class="popup br-5">'
                          + '<p class="ac f14 white">'+cfg.content+'</p><div class="popup_btn">'
                          + btnstr + '</div></div></div>');
                    
                }else if(cfg.type == 'Dialog'){
                    
                    panel = $('<div><div class="jit-ui-panel"></div><div style="margin-top:120px" class="popup br-5"><p class="ac f14 white">'+cfg.content+'</p></div></div>');
                }
                
                panel.css({
                    'position':'fixed',
                    'left':'0',
                    'right':'0',
                    'top':'0',
                    'bottom':'0',
                    'z-index':'99'
                });
                /*
                var dialogdom =$('[name=jitdialog]');
                dialogdom.css({
                    'left':(Jit.winSize.width-dialogdom.width())/2,
                    'top':(Jit.winSize.height-dialogdom.height())/2,
                });
                */
                panel.appendTo($('body'));
                
                (function(panel,cfg){
                
                    setTimeout(function(){
                        
                        if(cfg.CallBackOk){
                            
                            $(panel.find('#jit_btn_ok')).bind('click',cfg.CallBackOk);
                        }
                        if(cfg.CallBackCancel){
                        
                            $(panel.find('#jit_btn_cancel')).bind('click',cfg.CallBackCancel);
                            
                        }else{
                        
                            $(panel.find('#jit_btn_cancel')).bind('click',function(){Jit.UI.Dialog('CLOSE');});
                        }
                    },16);
                    
                })(panel,cfg);
                
            }
            
        },//改变地址事件
        BindChangeEvent:function(){
            var self=this;
             self.elements.moreMap.tap(function(){
                var element=$(this);
                if (element.hasClass('on')) {
                  self.elements.moreAddress.hide();
                  self.elements.moreAddress.removeClass('showex');
                 element.removeClass('on');
                }else{
                  self.elements.moreAddress.show();
                  self.elements.moreAddress.addClass('showex');
                  element.addClass('on');
                }
            });
            $('.locationArea img').tap(function(){
                var element=$(this),curLng=element.data(self.keyList.lng),curLat=element.data(self.keyList.lat),address=element.data(self.keyList.address),store=element.data(self.keyList.store);
                    if (curLng&&curLat&&store) {
                    self.InitMap(curLng,curLat,store,address);
                    };
                   self.elements.moreAddress.hide();
            });

        },
           InitMap:function(lng, lat,store,address) {
            var me=this;
            var map = new BMap.Map("mapArea"); // 创建地图实例    
            var point = new BMap.Point(lng, lat); // 创建点坐标    
            map.centerAndZoom(point, 17); // 初始化地图，设置中心点坐标和地图级别    
            //添加缩放控件  
            map.addControl(new BMap.NavigationControl());
            map.addControl(new BMap.ScaleControl());
            // map.addControl(new BMap.OverviewMapControl());
            me.elements.conmenu.show();

            me.elements.goto.bind('click',function(){//导航事件
if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(datas) {
                   var positions = {
                        lng: 0,
                        lat: 0
                    };
                positions.lng = datas.coords.longitude;
                positions.lat = datas.coords.latitude;
                var drivingRoute = new BMap.DrivingRoute(map, {
                    renderOptions: {
                        map: map,
                        autoViewport: true
                    }
                });
                var clientPoint = new BMap.Point(positions.lng, positions.lat);
                drivingRoute.search(clientPoint, point);
                map.closeInfoWindow(); //关闭打开的窗口信息
                map.removeOverlay(marker); //关闭标注信息
            
            }, function(error) {
                switch (error.code) {
            case error.TIMEOUT:
                me.Dialog({
                    'content': '连接超时，请重试！',
                    'type': 'Alert',
                    'CallBackOk': function () {
                        me.Dialog('CLOSE');
                    }
                });
                break;
            case error.PERMISSION_DENIED:
                me.Dialog({
                    'content': '您拒绝了使用位置共享服务，查询已取消！',
                    'type': 'Alert',
                    'CallBackOk': function () {
                        me.Dialog('CLOSE');
                    }
                });
                break;
            case error.POSITION_UNAVAILABLE:
                me.Dialog({
                    'content': '亲爱的用户，非常抱歉，我们暂时无法为您所在的区域提供位置服务！',
                    'type': 'Alert',
                    'CallBackOk': function () {
                        me.Dialog('CLOSE');
                    }
                });
                break;
            case error.UNKNOWN_ERROR:
                me.Dialog({
                    'content': '一个未知的错误发生！',
                    'type': 'Alert',
                    'CallBackOk': function () {
                        me.Dialog('CLOSE');
                    }
                });
                break;
        }
       
            }, {enableHighAcuracy: true,timeout: 3000,maximumAge: 2000});
        }else{

        me.Dialog({
                    'content': '您的设备不支持定位功能！',
                    'type': 'Alert',
                    'CallBackOk': function () {
                        me.Dialog('CLOSE');
                    }
                });
                return false;
        }

            });


          var m = new BMap.Icon("http://img1.40017.cn/touch/cn/hotel/detail/mapIcon.png", new BMap.Size(36, 45));
                // 具体地址poi
                var marker = new BMap.Marker(point);
                // // 创建标注    
                map.addOverlay(marker); // 将标注添加到地图中 
                var infoBox=""; 

                if (store) {
                    infoBox+="<p style='font-size:14px;'>" + store + "</p>";

                };

                infoBox+="<p style='font-size:14px;'>" + address + "</p>";


                var addr = new BMap.InfoWindow(infoBox);
                marker.addEventListener("click", function() {
                    this.openInfoWindow(addr);
                });

                map.openInfoWindow(addr, point);

            $(window).on("resize", function() {
                map.centerAndZoom(point, 11);
            });
        },
    getUrlParam: function(key) {
        var value = "",
            itemarr = [],
            urlstr = window.location.href.split("?");

        if (urlstr[1]) {

            var item = urlstr[1].split("&");

            for (i = 0; i < item.length; i++) {

                itemarr = item[i].split("=");

                if (key == itemarr[0]) {

                    value = itemarr[1];
                }
            }
        }

        return value;
    },
    LoadMap: function() {
        var me = this;
        me.elements.goto=$('#goto');
        me.elements.conmenu=$('#conmenu');
        me.elements.moreAddress=$('#moreAddress');
        me.elements.moreMap=$('.moreMap');
        var panamLng = me.getUrlParam('lng'),
            paramLat = me.getUrlParam('lat'),
            showMore=me.getUrlParam('showmore');

            if (showMore) {//限制更多地址菜单
                me.elements.moreMap.show();
            };

        // debugger;
        if (panamLng && paramLat) {
            lng = parseFloat(panamLng);
            lat = parseFloat(paramLat);
            var address=decodeURI(me.getUrlParam("addr")),store=decodeURI(me.getUrlParam("store"));
            me.InitMap(lng, lat,store||'',address);
        };
        me.BindChangeEvent();

    }

};

Base.LoadMap();

</script>